<ROSETTASCRIPTS>

 <SCOREFXNS>
 	<hard weights=talaris2014.wts >
 		<Reweight scoretype=aa_composition weight=1.0 />
 	</hard>

 	<soft weights=soft_rep_design>
 		<Reweight scoretype=aa_composition weight=1.0 />
 	</soft>

 	<hard_bb weights=talaris2014.wts >
 		<Reweight scoretype=coordinate_constraint weight=2. />
 		<Reweight scoretype=cart_bonded weight = 0.5 />
 		<Reweight scoretype=pro_close weight=0.0/>
 	</hard_bb>

 </SCOREFXNS>

 <RESIDUE_SELECTORS>
   <Chain name=helices chains=X,Y/>

</RESIDUE_SELECTORS>

 <TASKOPERATIONS>

 	<ReadResfile name="resfile"/>
 	<IncludeCurrent name=current/>
 	<LimitAromaChi2 name=arochi />
 	<ExtraRotamersGeneric name=ex1_ex2 ex1=1 ex2=1/>
	<ExtraRotamersGeneric name=ex1 ex1=1/>

	<RestrictAbsentCanonicalAAS name=ala_only resnum=0 keep_aas="A" />

	<LayerDesign name=all_layers layer=others ignore_pikaa_natro=true>

 		<CombinedTasks name=symmetric_interface_core>
			<SelectBySASA state=bound mode=mc core=1 probe_radius=2.0 core_asa=35 surface_asa=50/>
			<all copy_layer=core />
			<Helix append="HYSTMVG"/>
			<Helix exclude="W"/>
		</CombinedTasks>

		<CombinedTasks name=symmetric_interface_boundary>
			<SelectBySASA state=bound mode=mc boundary=1 probe_radius=2.0 core_asa=35 surface_asa=50/>
 			<all copy_layer=boundary />
 			<Helix append="HNQYSTVM"/>
 		</CombinedTasks>

		<CombinedTasks name=symmetric_interface_surface>
			<SelectBySASA state=bound mode=mc surface=1 probe_radius=2.0 core_asa=35 surface_asa=50/>
			<all copy_layer=surface />
		</CombinedTasks>
 
 	</LayerDesign>

 <SelectBySASA name=select_core state=bound mode=mc core=1 probe_radius=2.0 core_asa=35 surface_asa=50/>
 <SelectBySASA name=select_boundary state=bound mode=mc boundary=1 probe_radius=2.0 core_asa=35 surface_asa=50 />
 <SelectBySASA name=select_surface state=bound mode=mc surface=1 probe_radius=2.0 core_asa=35 surface_asa=50 />


 </TASKOPERATIONS>


 <FILTERS>

 	<PackStat name=packstat threshold=0.4 confidence=1/>
 	<BuriedUnsatHbonds name=uhb scorefxn=hard confidence=0/>

 </FILTERS>

 <MOVERS>
 	
 	<PackRotamersMover name=transform_sc scorefxn=hard task_operations=ala_only/>
 	<ConstraintSetMover name="add_cst" cst_file="%%cst_file%%"/>
 	<MinMover name=hardmin_bb scorefxn=hard_bb type=lbfgs_armijo_nonmonotone tolerance=0.001 chi=1 bb=1 bondangle=1 bondlength=1 jump=all cartesian=1 max_iter=1000 />
 	<ClearConstraintsMover name=clearconstraints/>

 	<AddCompositionConstraintMover name=addcomp1 filename="%%comp_file%%" selector=helices/>

 	<PackRotamersMover name=softpack_core scorefxn=soft task_operations=resfile,current,arochi,select_core/>
 	<PackRotamersMover name=softpack_boundary scorefxn=soft task_operations=resfile,current,arochi,select_boundary/>
	<PackRotamersMover name=softpack_surface scorefxn=soft task_operations=resfile,current,arochi,select_surface/>
	
	<MinMover name=hardmin_sconly scorefxn=hard chi=1 bb=0 bondangle=0 bondlength=0/>

	<PackRotamersMover name=hardpack_core scorefxn=hard task_operations=resfile,current,arochi,ex1_ex2,select_core/>
	<PackRotamersMover name=hardpack_boundary scorefxn=hard task_operations=resfile,current,arochi,ex1_ex2,select_boundary/>
	<PackRotamersMover name=hardpack_surface scorefxn=hard task_operations=resfile,current,arochi,ex1_ex2,select_surface/>


 </MOVERS>

 <APPLY_TO_POSE>
 </APPLY_TO_POSE>

 <PROTOCOLS>
 	<Add mover=transform_sc/>
 	<Add mover=add_cst/>
 	<Add mover=hardmin_bb/>
 	<Add mover=clearconstraints/>

 	<Add mover=addcomp1/>

 	<Add mover=softpack_core/>
 	<Add mover=softpack_boundary/>
 	<Add mover=softpack_surface/>
 	<Add mover=hardmin_sconly/>
 	<Add mover=hardpack_core/>
 	<Add mover=hardpack_boundary/>
 	<Add mover=hardpack_surface/>

	<Add filter=packstat/>
 	<Add filter=uhb/>

 </PROTOCOLS>

<OUTPUT scorefxn="talaris2014"/>

</ROSETTASCRIPTS>